#!/bin/bash

# ì‘ì—… ë””ë ‰í† ë¦¬ (bam íŒŒì¼ë“¤ì´ ìˆëŠ” ê³³)
WORKDIR="/Volumes/HDD/AndyPark/repeats_expression/20220619_rDNAdel_rpoa2degron/align"
cd "$WORKDIR" || exit

# bw ì €ì¥ ë””ë ‰í† ë¦¬ ìƒì„±
mkdir -p bw

echo "ğŸ”„ Step 1: BAM â†’ BW ë³€í™˜ ì‹œì‘..."
for bam in *.bam; do
    sample=$(basename "$bam" .bam)
    echo "  ğŸ“‚ ì²˜ë¦¬ ì¤‘: $sample"
    bamCoverage -b "$bam" -o "bw/${sample}.bw" --normalizeUsing CPM
done
echo "âœ… Step 1 ì™„ë£Œ: ëª¨ë“  BAM â†’ BW ë³€í™˜ë¨"

# í‰ê·  bigWig ë§Œë“¤ê¸°
echo "ğŸ”„ Step 2: í‰ê·  bigWig ê³„ì‚° ì¤‘..."
wiggletools mean bw/*.bw > mean.wig

# reference genomeì´ ce10ì´ë¼ê³  ê°€ì •
echo "ğŸ“ Step 3: chrom.sizes ê°€ì ¸ì˜¤ê¸°..."
fetchChromSizes ce10 > ce10.chrom.sizes

# wig â†’ bigWig

echo "ğŸ“¦ Step 4: wig â†’ bigWig ë³€í™˜ ì¤‘..."
wigToBigWig mean.wig ce10.chrom.sizes mean.bw
echo "âœ… í‰ê·  mean.bw íŒŒì¼ ìƒì„± ì™„ë£Œ!"



0
